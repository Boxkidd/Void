<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Void: Geometric Evolution</title>
    <style>
        :root { 
            --cyan: #00f2ff; --onyx: #050505; --purple: #bc13fe; 
            --gold: #ffd700; --red: #ff4444; --active-color: var(--cyan);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--onyx); color: white; margin: 0; 
            font-family: 'Inter', system-ui, sans-serif; overflow: hidden;
            display: flex; height: 100vh;
        }

        /* Sidebar: Command Center */
        #command-center {
            width: 180px; background: #0a0a0a; border-right: 1px solid #222;
            padding: 25px 15px; display: flex; flex-direction: column; gap: 20px;
            box-shadow: 10px 0 30px rgba(0,0,0,0.5); z-index: 100;
        }
        .stat-label { font-size: 0.55rem; color: #555; text-transform: uppercase; font-weight: 900; letter-spacing: 1px; }
        .stat-value { font-size: 1rem; color: var(--active-color); font-weight: 900; display: block; margin-top: 2px; }
        .divider { height: 1px; background: #222; margin: 5px 0; }

        /* Main Game View */
        #stage { flex: 1; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at center, #111 0%, #050505 100%); }
        #top-nav { padding: 20px; text-align: center; }
        #essence-display { font-size: 3rem; font-weight: 900; color: var(--active-color); text-shadow: 0 0 20px var(--active-color); }

        /* Dice Visuals */
        #dice-floor { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; padding: 20px; min-height: 200px; align-content: center; }
        
        .die { 
            width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; 
            font-size: 1.2rem; font-weight: 900; background: #000; border: 2px solid var(--active-color);
            transition: 0.1s; position: relative;
        }
        /* Geometric Shapes */
        .d6 { border-radius: 4px; }
        .d12 { border-radius: 18px; border-width: 3px; }
        .d20 { border-radius: 50% 10% 50% 10%; transform: rotate(45deg); }
        .d20 span { transform: rotate(-45deg); }
        .d100 { border-radius: 50%; box-shadow: 0 0 15px var(--active-color); border-style: double; }

        .die.rolling { transform: scale(1.2) rotate(15deg); filter: brightness(2); }
        .die.crit { border-color: var(--gold); color: var(--gold); box-shadow: 0 0 20px var(--gold); }

        /* Navigation */
        .tab-bar { display: flex; background: #080808; border-top: 1px solid #222; }
        .tab { flex: 1; text-align: center; padding: 20px; font-size: 0.6rem; color: #444; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        .tab.active { color: white; border-bottom: 3px solid var(--active-color); background: #111; }

        .panel { display: none; padding: 20px; height: 35vh; overflow-y: auto; background: #080808; }
        .panel.active { display: block; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 15px; background: #0d0d0d; border-radius: 8px; border: 1px solid #1a1a1a; }
        .btn { color: var(--active-color); border: 1px solid var(--active-color); padding: 10px 15px; border-radius: 4px; font-size: 0.65rem; cursor: pointer; background: transparent; font-weight: 900; }
        .btn:disabled { opacity: 0.2; }
    </style>
</head>
<body>

    <aside id="command-center">
        <div>
            <span class="stat-label">Omni-Essence</span>
            <span id="side-essence" class="stat-value">0</span>
        </div>
        <div class="divider"></div>
        <div>
            <span class="stat-label">Essence / Sec</span>
            <span id="side-cps" class="stat-value">0</span>
        </div>
        <div>
            <span class="stat-label">Global Multi</span>
            <span id="side-mult" class="stat-value">1.0x</span>
        </div>
        <div class="divider"></div>
        <div>
            <span class="stat-label">Void Shards</span>
            <span id="side-shards" class="stat-value" style="color:var(--purple)">0</span>
        </div>
        <div>
            <span class="stat-label">Core Breaches</span>
            <span id="side-kills" class="stat-value" style="color:var(--red)">0</span>
        </div>
    </aside>

    <main id="stage">
        <div id="top-nav">
            <div id="essence-display">0</div>
        </div>

        <div id="dice-floor" onclick="manualRoll()"></div>

        <nav class="tab-bar">
            <div class="tab active" onclick="tab('upgrades')">Manifest</div>
            <div class="tab" onclick="tab('forge')">Forge</div>
            <div class="tab" onclick="tab('store')">Skins</div>
        </nav>

        <div class="panel active" id="upgrades">
            <div class="row">
                <div>Manifest Die<br><small id="slot-label">Slot: D6</small></div>
                <button id="btn-add-die" class="btn" onclick="addDie()">500</button>
            </div>
            <div id="auto-upgrades"></div>
        </div>

        <div class="panel" id="forge">
            <div id="forge-list"></div>
        </div>

        <div class="panel" id="store">
            <div class="row"><div>Cyan (1.2x Speed)</div><button class="btn" onclick="setSkin('cyan', 0)">Equip</button></div>
            <div class="row"><div>Ghostly (5x Crit)</div><button id="btn-skin-ghost" class="btn" onclick="setSkin('ghostly', 50)">50 S</button></div>
            <div class="row"><div>Gold (1.5x Essence)</div><button id="btn-skin-gold" class="btn" onclick="setSkin('gold', 150)">150 S</button></div>
        </div>
    </main>

    <script>
        let s = {
            e: 0, shards: 0, kills: 0,
            dice: [{type: 6, auto: 0}], // Start with 1 D6
            relics: [], relicLevels: {},
            ownedSkins: ['cyan'], skin: 'cyan'
        };

        const LIMITS = { 6: 4, 12: 2, 20: 2, 100: 1 };
        const RELIC_META = { "ðŸ”¥": "Infernal", "â„ï¸": "Frozen", "âš¡": "Pulse" };
        let autoTimers = [];

        function tab(t) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
        }

        function getNextDieType() {
            let counts = {6:0, 12:0, 20:0, 100:0};
            s.dice.forEach(d => counts[d.type]++);
            if(counts[6] < LIMITS[6]) return 6;
            if(counts[12] < LIMITS[12]) return 12;
            if(counts[20] < LIMITS[20]) return 20;
            if(counts[100] < LIMITS[100]) return 100;
            return null;
        }

        function addDie() {
            let type = getNextDieType();
            let cost = Math.pow(10, s.dice.length + 1);
            if(type && s.e >= cost) {
                s.e -= cost;
                s.dice.push({type: type, auto: 0});
                renderGame();
            }
        }

        function rollDie(idx) {
            const dEl = document.getElementById(`die-${idx}`);
            if(!dEl) return;
            dEl.classList.add('rolling');
            
            setTimeout(() => {
                let dData = s.dice[idx];
                let val = Math.floor(Math.random() * dData.type) + 1;
                let isCrit = Math.random() < 0.1;
                dEl.innerHTML = `<span>${val}</span>`;
                dEl.classList.remove('rolling');
                dEl.className = `die d${dData.type} ${isCrit ? 'crit' : ''}`;

                let mult = isCrit ? (s.skin === 'ghostly' ? 50 : 10) : 1;
                Object.values(s.relicLevels).forEach(l => mult += (l * 0.5));
                let finalGain = val * mult * (s.skin === 'gold' ? 1.5 : 1);
                
                s.e += finalGain;
                updateStats();
            }, 100);
        }

        function manualRoll() { s.dice.forEach((_, i) => rollDie(i)); }

        function upgradeAuto(idx) {
            let cost = 500 * Math.pow(2, s.dice[idx].auto);
            if(s.e >= cost && s.dice[idx].auto < 5) {
                s.e -= cost;
                s.dice[idx].auto++;
                refreshTimers();
                renderGame();
            }
        }

        function refreshTimers() {
            autoTimers.forEach(t => clearInterval(t));
            autoTimers = s.dice.map((d, i) => {
                if(d.auto === 0) return null;
                let speed = 1000 - ((d.auto - 1) * 200);
                if(s.skin === 'cyan') speed *= 0.8;
                return setInterval(() => rollDie(i), Math.max(speed, 100));
            });
        }

        function renderGame() {
            const floor = document.getElementById('dice-floor');
            floor.innerHTML = '';
            s.dice.forEach((d, i) => {
                let div = document.createElement('div');
                div.id = `die-${i}`;
                div.className = `die d${d.type}`;
                div.innerHTML = `<span>${d.type}</span>`;
                floor.appendChild(div);
            });

            const upContainer = document.getElementById('auto-upgrades');
            upContainer.innerHTML = s.dice.map((d, i) => `
                <div class="row">
                    <div>Die ${i+1} (D${d.type})<br><small>Speed: ${d.auto > 0 ? (1000-(d.auto-1)*200)+'ms' : 'OFF'}</small></div>
                    <button class="btn" onclick="upgradeAuto(${i})">${d.auto >= 5 ? 'MAX' : (500*Math.pow(2, d.auto))}</button>
                </div>
            `).join('');

            let next = getNextDieType();
            document.getElementById('slot-label').innerText = next ? `Next: D${next}` : "MAX SLOTS";
            document.getElementById('btn-add-die').innerText = Math.pow(10, s.dice.length + 1).toLocaleString();
            updateStats();
        }

        function updateStats() {
            const essStr = Math.floor(s.e).toLocaleString();
            document.getElementById('essence-display').innerText = essStr;
            document.getElementById('side-essence').innerText = essStr;
            document.getElementById('side-shards').innerText = s.shards;
            document.getElementById('side-kills').innerText = s.kills;

            let m = (s.skin === 'gold' ? 1.5 : 1);
            Object.values(s.relicLevels).forEach(l => m += (l * 0.5));
            document.getElementById('side-mult').innerText = m.toFixed(1) + "x";

            // CPS Calculation
            let totalCps = 0;
            s.dice.forEach(d => {
                if(d.auto > 0) {
                    let rollsPerSec = 1000 / (1000 - ((d.auto-1)*200));
                    totalCps += (d.type / 2) * rollsPerSec * m;
                }
            });
            document.getElementById('side-cps').innerText = Math.floor(totalCps).toLocaleString();
            
            localStorage.setItem('void_geo_save', JSON.stringify(s));
        }

        function setSkin(id, cost) {
            if(s.ownedSkins.includes(id)) {
                s.skin = id;
                document.documentElement.style.setProperty('--active-color', (id==='cyan'?'#00f2ff':id==='ghostly'?'#bc13fe':'#ffd700'));
                refreshTimers();
            } else if(s.shards >= cost) {
                s.shards -= cost; s.ownedSkins.push(id); setSkin(id, 0);
            }
            updateStats();
        }

        window.onload = () => {
            let saved = localStorage.getItem('void_geo_save');
            if(saved) s = Object.assign(s, JSON.parse(saved));
            renderGame(); refreshTimers(); setSkin(s.skin, 0);
        };
    </script>
</body>
</html>