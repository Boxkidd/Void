<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Void: Unified Singularity</title>
    <style>
        :root { 
            --cyan: #00f2ff; --onyx: #050505; --purple: #bc13fe; 
            --gold: #ffd700; --active-color: var(--cyan);
            --safe-top: env(safe-area-inset-top);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--onyx); color: white; margin: 0; 
            font-family: 'Inter', sans-serif; overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
        }

        #top-nav { padding-top: calc(var(--safe-top) + 10px); text-align: center; flex: 0 0 auto;}
        #essence-count { font-size: 2.8rem; color: var(--active-color); text-shadow: 0 0 20px var(--active-color); font-weight: 900; }
        
        #overdrive-container { width: 60%; height: 6px; background: #111; margin: 10px auto; border-radius: 3px; overflow: hidden; border: 1px solid #222; }
        #overdrive-bar { height: 100%; width: 0%; background: var(--gold); transition: width 0.1s linear; }

        #game-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        #dice-floor { display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 12px; width: 90%; max-width: 360px; justify-items: center; }
        .die { width: 65px; height: 65px; border: 2px solid var(--active-color); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border-radius: 12px; background: #000; transition: 0.1s;}
        .die.rolling { transform: scale(1.1) rotate(10deg); }
        .die.crit { border-color: var(--gold); color: var(--gold); box-shadow: 0 0 20px var(--gold); }

        .tab-bar { display: flex; background: #080808; border-top: 1px solid #222; flex: 0 0 auto; overflow-x: auto;}
        .tab { flex: 1; text-align: center; padding: 15px; font-size: 0.6rem; color: #555; font-weight: 900; cursor: pointer; text-transform: uppercase; white-space: nowrap; min-width: 100px;}
        .tab.active { color: white; border-bottom: 2px solid var(--active-color); background: #0c0c0c;}

        .panel { display: none; padding: 20px; height: 40vh; overflow-y: auto; background: #080808; }
        .panel.active { display: block; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 12px; background: #0c0c0c; border-radius: 10px; border: 1px solid #1a1a1a; }
        .btn { color: var(--active-color); border: 1px solid var(--active-color); padding: 8px 15px; border-radius: 8px; font-size: 0.7rem; cursor: pointer; background: transparent; font-weight: 900; }
        .btn:disabled { opacity: 0.2; color: #333; border-color: #333;}
        
        .trait-locked { opacity: 0.3; filter: grayscale(1); }
        .trait-unlocked { border-color: var(--gold); background: rgba(255, 215, 0, 0.05); }
    </style>
</head>
<body>

    <div id="top-nav">
        <div id="essence-count">0</div>
        <div id="overdrive-container"><div id="overdrive-bar"></div></div>
        <div style="font-size:0.65rem; color:var(--purple); font-weight:bold; letter-spacing: 1px;">
            SHARDS: <span id="shard-val">0</span> | KILLS: <span id="kill-val">0</span> | COMBO: <span id="combo-val">1.0</span>x
        </div>
    </div>

    <div id="game-area">
        <div id="dice-floor" onclick="roll()"></div>
        <button id="od-btn" class="btn" style="margin-top:20px; border-color:var(--gold); color:var(--gold); display:none;" onclick="triggerOverdrive()">ACTIVATE OVERDRIVE</button>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="tab('upgrades')">Upgrades</div>
        <div class="tab" onclick="tab('forge')">Forge</div>
        <div class="tab" onclick="tab('bestiary')">Bestiary</div>
    </div>

    <div class="panel active" id="upgrades">
        <div class="row"><div>Auto-Link<br><small id="auto-lvl">Lvl 0</small></div><button class="btn" onclick="buy('auto')">100</button></div>
        <div class="row"><div>Evolution<br><small id="evolve-lvl">D6</small></div><button class="btn" onclick="buy('evolve')">1M</button></div>
        <button class="btn" style="width:100%; margin-top:10px; border-color:var(--purple); color:var(--purple)" onclick="spawnBoss()">BREACH CORE (10k)</button>
    </div>

    <div class="panel" id="forge">
        <div id="forge-list"><div style="text-align:center; color:#444; margin-top:20px;">No relics found.</div></div>
    </div>

    <div class="panel" id="bestiary">
        <div id="soul-traits">
            <div class="row trait-locked" id="trait-10"><div>Gilded Soul (10 Kills)<br><small>+25% Essence Gain</small></div></div>
            <div class="row trait-locked" id="trait-25"><div>Quantum Soul (25 Kills)<br><small>2x Overdrive Charge Speed</small></div></div>
            <div class="row trait-locked" id="trait-50"><div>Eternal Soul (50 Kills)<br><small>20% Cheaper Forge Upgrades</small></div></div>
        </div>
    </div>

    <script>
        let s = {
            e: 0, auto: 0, dice: 1, ev: 0, shards: 0, kills: 0,
            odCharge: 0, odActive: false,
            combo: 1, lastRollTime: 0,
            relics: [], 
            relicLevels: { "ðŸ”¥": 1, "â„ï¸": 1, "âš¡": 1, "ðŸ‘ï¸": 1 }
        };

        const RELIC_DATA = {
            "ðŸ”¥": { name: "Infernal Core", base: 50, scale: 20 },
            "â„ï¸": { name: "Zero Point", base: 2, scale: 0.5 },
            "âš¡": { name: "Pulse Link", base: 10, scale: 5 },
            "ðŸ‘ï¸": { name: "Void Eye", base: 10, scale: 5 }
        };

        const DICE = [{s:6, c:1e6}, {s:12, c:50e6}, {s:20, c:1e9}, {s:100, c:Infinity}];

        function tab(t) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
        }

        function roll(isAuto = false) {
            const floor = document.getElementById('dice-floor');
            floor.innerHTML = '';
            let total = 0, sides = DICE[s.ev].s;

            let now = Date.now();
            if (now - s.lastRollTime < 1500) s.combo = Math.min(5, s.combo + 0.05);
            else s.combo = 1;
            s.lastRollTime = now;

            for(let i=0; i < s.dice; i++) {
                let v = Math.floor(Math.random() * sides) + 1;
                let eyeProcChance = s.relics.includes("ðŸ‘ï¸") ? (RELIC_DATA["ðŸ‘ï¸"].base + (s.relicLevels["ðŸ‘ï¸"]-1) * RELIC_DATA["ðŸ‘ï¸"].scale) / 100 : 0.05;
                let isCrit = Math.random() < 0.05;
                let eyeProc = Math.random() < eyeProcChance;
                
                let d = document.createElement('div');
                d.className = `die ${isCrit ? 'crit' : ''} rolling`;
                d.innerText = v;
                floor.appendChild(d);

                let critMult = s.relics.includes("ðŸ”¥") ? (RELIC_DATA["ðŸ”¥"].base + (s.relicLevels["ðŸ”¥"]-1) * RELIC_DATA["ðŸ”¥"].scale) : 10;
                let val = v * (isCrit ? critMult : 1);
                if (eyeProc) val *= 2;
                total += val;
            }

            let gildedBonus = s.kills >= 10 ? 1.25 : 1;
            s.e += total * s.combo * (1 + s.shards * 0.1) * gildedBonus;

            if (!s.odActive) {
                let odMulti = s.kills >= 25 ? 0.4 : 0.2;
                s.odCharge = Math.min(100, s.odCharge + odMulti);
            }
            updateUI();
        }

        function triggerOverdrive() {
            s.odActive = true;
            document.getElementById('od-btn').style.display = 'none';
            let odInt = setInterval(() => {
                s.odCharge -= 2;
                roll(true);
                if (s.odCharge <= 0) { clearInterval(odInt); s.odActive = false; }
                updateUI();
            }, 100);
        }

        function spawnBoss() {
            if (s.e < 10000) return;
            s.e -= 10000;
            s.kills++;
            let shardBonus = s.relics.includes("â„ï¸") ? (RELIC_DATA["â„ï¸"].base + (s.relicLevels["â„ï¸"]-1) * RELIC_DATA["â„ï¸"].scale) : 5;
            s.shards += Math.floor(shardBonus);

            let pool = Object.keys(RELIC_DATA).filter(r => !s.relics.includes(r));
            if (pool.length > 0 && Math.random() > 0.4) s.relics.push(pool[0]);
            updateUI();
        }

        function upgradeRelic(r) {
            let discount = s.kills >= 50 ? 0.8 : 1;
            let cost = Math.floor(s.relicLevels[r] * 15 * discount);
            if (s.shards >= cost) {
                s.shards -= cost;
                s.relicLevels[r]++;
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('essence-count').innerText = Math.floor(s.e).toLocaleString();
            document.getElementById('shard-val').innerText = s.shards;
            document.getElementById('kill-val').innerText = s.kills;
            document.getElementById('overdrive-bar').style.width = s.odCharge + '%';
            document.getElementById('combo-val').innerText = s.combo.toFixed(1);
            if (s.odCharge >= 100) document.getElementById('od-btn').style.display = 'block';

            if (s.relics.length > 0) {
                document.getElementById('forge-list').innerHTML = s.relics.map(r => {
                    let discount = s.kills >= 50 ? 0.8 : 1;
                    let cost = Math.floor(s.relicLevels[r] * 15 * discount);
                    return `<div class="row">
                        <div>${r} ${RELIC_DATA[r].name}<br><small>Level ${s.relicLevels[r]}</small></div>
                        <button class="btn" ${s.shards < cost ? 'disabled' : ''} onclick="upgradeRelic('${r}')">${cost} S</button>
                    </div>`;
                }).join('');
            }

            // Traits UI
            [10, 25, 50].forEach(k => {
                let el = document.getElementById('trait-'+k);
                if (s.kills >= k) { el.classList.remove('trait-locked'); el.classList.add('trait-unlocked'); }
            });

            localStorage.setItem('void_unified_save', JSON.stringify(s));
        }

        function buy(type) {
            let cost = type === 'auto' ? 100 * Math.pow(1.5, s.auto) : DICE[s.ev].c;
            if (s.e >= cost) {
                s.e -= cost;
                if(type === 'auto') s.auto++; else s.ev++;
                updateUI();
            }
        }

        setInterval(() => { if (s.auto > 0 && !s.odActive) roll(true); }, 1000 / (s.auto || 0.1));

        const saved = localStorage.getItem('void_unified_save');
        if (saved) s = {...s, ...JSON.parse(saved)};
        updateUI();
    </script>
</body>
</html>