<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="manifest" href="manifest.json">
    <title>Void Dice: Singularity</title>
    <style>
        :root { 
            --cyan: #00f2ff; --onyx: #050505; --purple: #bc13fe; 
            --gray: #444; --gold: #ffd700; --red: #ff4444;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            background-color: var(--onyx); color: white; margin: 0; 
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden; display: flex; flex-direction: column; 
            height: 100vh; height: -webkit-fill-available;
        }
        #void-bg {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100vmax; height: 100vmax; background: radial-gradient(circle, var(--cyan) 0%, transparent 70%);
            filter: blur(80px); z-index: -1; opacity: 0; transition: opacity 2s;
        }
        #top-nav { padding-top: calc(var(--safe-top) + 20px); text-align: center; width: 100%; flex: 0 1 auto; }
        #essence-count { font-size: clamp(2.5rem, 10vw, 4.5rem); color: var(--cyan); text-shadow: 0 0 20px var(--cyan); font-weight: 900; }
        #milestone-container { width: 85%; max-width: 500px; margin: 10px auto; }
        #milestone-bar { width: 100%; height: 6px; background: #1a1a1a; border-radius: 3px; overflow: hidden; }
        #milestone-progress { height: 100%; background: var(--cyan); width: 0%; transition: width 0.4s; }
        #game-area { flex: 1 1 auto; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; }
        #dice-floor { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(75px, 1fr));
            gap: 15px; width: 90%; max-width: 400px; justify-items: center; margin: 20px 0;
        }
        .die { 
            width: clamp(65px, 18vw, 90px); height: clamp(65px, 18vw, 90px); 
            border: 2px solid var(--cyan); display: flex; align-items: center; 
            justify-content: center; font-size: 2.2rem; border-radius: 14px; 
            background: black; box-shadow: 0 0 15px rgba(0,242,255,0.2); transition: 0.1s;
        }
        .die.crit { border-color: var(--gold); color: var(--gold); box-shadow: 0 0 25px var(--gold); transform: scale(1.1); }
        .panel { 
            width: 100%; max-width: 600px; background: rgba(10, 10, 10, 0.96); 
            padding: 20px; padding-bottom: calc(var(--safe-bottom) + 20px);
            border-radius: 35px 35px 0 0; border-top: 1px solid #333; 
            backdrop-filter: blur(25px); align-self: center;
        }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .btn { 
            color: var(--cyan); border: 1px solid var(--cyan); padding: 12px 20px; 
            border-radius: 12px; font-size: 0.9rem; cursor: pointer; background: transparent;
            font-weight: bold; transition: 0.2s;
        }
        .btn:active { transform: scale(0.92); background: var(--cyan); color: black; }
        .buy-max-btn { font-size: 0.7rem; color: var(--gray); border: 1px solid var(--gray); padding: 5px 14px; border-radius: 20px; cursor: pointer; }
        .buy-max-active { color: var(--cyan); border-color: var(--cyan); background: rgba(0,242,255,0.1); }
        .crit-text { position: absolute; color: var(--gold); font-weight: 900; animation: floatText 0.6s forwards; pointer-events: none; z-index: 10; }
        @keyframes floatText { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: translateY(-80px) scale(1.6); } }
    </style>
</head>
<body>
    <div id="void-bg"></div>
    <div id="top-nav">
        <div style="letter-spacing: 5px; color: var(--gray); font-size: 0.75rem; font-weight: bold;">VOID SINGULARITY</div>
        <div id="essence-count">0</div>
        <div id="milestone-container">
            <div id="milestone-bar"><div id="milestone-progress"></div></div>
            <div id="milestone-label" style="font-size: 0.65rem; color: var(--gray); margin-top: 10px; letter-spacing: 1px;">0% TO TRANSCENDENCE</div>
        </div>
    </div>
    <div id="game-area">
        <div id="dice-floor" onclick="roll()"></div>
        <div style="display: flex; gap: 20px; margin-top: 30px;">
            <button id="oc-btn" class="btn" style="display:none; border-color: var(--red); color: var(--red);" onclick="activateOverclock()">OVERCLOCK</button>
            <button class="btn" style="padding: 18px 60px; font-size: 1.2rem; border-radius: 40px; border-width: 2px;" onclick="roll()">ROLL</button>
        </div>
    </div>
    <div class="panel">
        <div class="row">
            <span style="font-size: 0.75rem; color: var(--gray); letter-spacing: 2px; font-weight: 900;">NEURAL UPGRADES</span>
            <div id="buy-max-btn" class="buy-max-btn" onclick="toggleBuyMax()">BUY: 1X</div>
        </div>
        <div class="row">
            <div class="info"><span>Auto-Roller</span><br><span id="auto-lvl" style="font-size:0.75rem; color:var(--gray)">Lvl 0</span></div>
            <button class="btn" id="cost-auto" onclick="attemptBuy('auto')">100</button>
        </div>
        <div class="row" id="row-speed" style="display:none;">
            <div class="info"><span>Clock Speed</span><br><span id="speed-lvl" style="font-size:0.75rem; color:var(--gray)">x1.0</span></div>
            <button class="btn" id="cost-speed" onclick="attemptBuy('speed')">1.0k</button>
        </div>
        <div class="row" id="row-dice" style="display:none;">
            <div class="info"><span>Dice Count</span><br><span id="dice-lvl" style="font-size:0.75rem; color:var(--gray)">1 Die</span></div>
            <button class="btn" id="cost-dice" onclick="attemptBuy('dice')">25k</button>
        </div>
        <div id="prestige-area" style="display:none; border-top: 1px solid #333; padding-top: 20px;">
            <div class="row">
                <div class="info"><span style="color:var(--purple); font-weight: 900;">TRANSCEND</span><br><span id="prestige-gain" style="font-size:0.75rem; color:var(--purple)">+0 Shards</span></div>
                <button class="btn" style="color:var(--purple); border-color:var(--purple)" onclick="transcend()">ASCEND</button>
            </div>
        </div>
    </div>

    <script>
        let state = { 
            essence: 0, autoLvl: 0, speedLvl: 1, diceCount: 1, 
            shards: 0, lastSave: Date.now() 
        };
        let buyMaxMode = false;
        let isOverclocked = false;

        const CONFIG = {
            auto: { base: 100, grow: 1.15 },
            speed: { base: 1000, grow: 2.2 },
            dice: { base: 25000, grow: 18.0 }
        };

        function format(n) {
            if (n >= 1e15) return (n/1e15).toFixed(2) + "Q";
            if (n >= 1e12) return (n/1e12).toFixed(2) + "T";
            if (n >= 1e9) return (n/1e9).toFixed(2) + "B";
            if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
            if (n >= 1e3) return (n/1e3).toFixed(1) + "k";
            return Math.floor(n);
        }

        function toggleBuyMax() {
            buyMaxMode = !buyMaxMode;
            document.getElementById('buy-max-btn').innerText = buyMaxMode ? "BUY: MAX" : "BUY: 1X";
            document.getElementById('buy-max-btn').classList.toggle('buy-max-active');
        }

        function attemptBuy(type) {
            const conf = CONFIG[type];
            let cur = (type === 'auto') ? state.autoLvl : (type === 'speed') ? Math.round((state.speedLvl - 1) * 2) : (state.diceCount - 1);
            if (buyMaxMode) {
                while (state.essence >= conf.base * Math.pow(conf.grow, cur)) {
                    state.essence -= conf.base * Math.pow(conf.grow, cur);
                    cur++;
                    if (type === 'auto') state.autoLvl++;
                    else if (type === 'speed') state.speedLvl += 0.5;
                    else if (type === 'dice' && state.diceCount < 6) state.diceCount++;
                }
            } else {
                let cost = conf.base * Math.pow(conf.grow, cur);
                if (state.essence >= cost) {
                    state.essence -= cost;
                    if (type === 'auto') state.autoLvl++;
                    else if (type === 'speed') state.speedLvl += 0.5;
                    else if (type === 'dice' && state.diceCount < 6) state.diceCount++;
                }
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('essence-count').innerText = format(state.essence);
            document.getElementById('auto-lvl').innerText = "Lvl " + state.autoLvl;
            document.getElementById('speed-lvl').innerText = "x" + state.speedLvl.toFixed(1);
            document.getElementById('dice-lvl').innerText = state.diceCount + " Dice";
            document.getElementById('cost-auto').innerText = format(CONFIG.auto.base * Math.pow(CONFIG.auto.grow, state.autoLvl));
            document.getElementById('cost-speed').innerText = format(CONFIG.speed.base * Math.pow(CONFIG.speed.grow, Math.round((state.speedLvl - 1) * 2)));
            document.getElementById('cost-dice').innerText = (state.diceCount < 6) ? format(CONFIG.dice.base * Math.pow(CONFIG.dice.grow, state.diceCount - 1)) : "MAX";
            let prog = Math.min((state.essence / 1e6) * 100, 100);
            document.getElementById('milestone-progress').style.width = prog + "%";
            document.getElementById('milestone-label').innerText = Math.floor(prog) + "% TO TRANSCENDENCE";
            if(state.essence > 500 || state.speedLvl > 1) document.getElementById('row-speed').style.display = 'flex';
            if(state.essence > 15000 || state.diceCount > 1) document.getElementById('row-dice').style.display = 'flex';
            if(state.essence > 1e6 || state.shards > 0) {
                document.getElementById('prestige-area').style.display = 'block';
                document.getElementById('prestige-gain').innerText = "+" + Math.floor(Math.sqrt(state.essence/1e6)) + " Shards";
            }
            if(state.autoLvl >= 10) document.getElementById('oc-btn').style.display = 'block';
            document.getElementById('void-bg').style.opacity = Math.min(state.essence / 1e7, 0.75);
            localStorage.setItem('voidDiceSingularity', JSON.stringify(state));
        }

        function roll() {
            let total = 0;
            const floor = document.getElementById('dice-floor');
            floor.innerHTML = '';
            for(let i=0; i < state.diceCount; i++) {
                const isCrit = Math.random() < 0.06;
                const val = Math.floor(Math.random() * 6) + 1;
                const d = document.createElement('div');
                d.className = `die ${isCrit ? 'crit' : ''}`;
                d.style.transform = `rotate(${Math.random()*40-20}deg)`;
                d.innerText = val;
                floor.appendChild(d);
                total += val * (isCrit ? 10 : 1);
                if(isCrit) spawnCritText();
            }
            if (navigator.vibrate) navigator.vibrate(10);
            state.essence += total * (isOverclocked ? 4 : 1) * (1 + (state.shards * 0.2));
            updateUI();
        }

        function spawnCritText() {
            const t = document.createElement('div');
            t.className = 'crit-text'; t.innerText = 'CRIT!';
            t.style.left = (Math.random() * 50 + 25) + '%';
            t.style.top = (Math.random() * 20 + 35) + '%';
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 600);
        }

        function activateOverclock() {
            if(isOverclocked) return;
            isOverclocked = true;
            document.getElementById('oc-btn').style.opacity = 0.3;
            setTimeout(() => { isOverclocked = false; document.getElementById('oc-btn').style.opacity = 1; }, 12000);
        }

        function transcend() {
            let g = Math.floor(Math.sqrt(state.essence/1e6));
            if(g >= 1 && confirm(`Sacrifice progress for ${g} shards?`)) {
                state.shards += g; state.essence = 0; state.autoLvl = 0; state.speedLvl = 1; state.diceCount = 1;
                updateUI();
            }
        }

        const saved = localStorage.getItem('voidDiceSingularity');
        if (saved) state = {...state, ...JSON.parse(saved)};
        setInterval(() => {
            if (state.autoLvl > 0) {
                state.essence += (3 * state.autoLvl * state.diceCount * state.speedLvl * (isOverclocked ? 4 : 1)) / 10;
                updateUI();
            }
        }, 100);
        updateUI();
        document.getElementById('dice-floor').innerHTML = '<div class="die">?</div>';
    </script>
</body>
</html>